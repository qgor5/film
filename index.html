<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Фильмы по жанрам с TMDb API</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #genre-menu { margin-bottom: 20px; }
  .genre-link {
    cursor: pointer;
    margin-right: 10px;
    color: blue;
    text-decoration: underline;
  }
  .genre-link.active {
    font-weight: bold;
    color: darkred;
    text-decoration: none;
  }
  #movies-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
  }
  .movie {
    border: 1px solid #ccc;
    padding: 10px;
    width: 180px;
  }
  .movie img {
    width: 100%;
    height: auto;
  }
  .movie h4 {
    margin: 8px 0 5px 0;
    font-size: 16px;
  }
  .movie p {
    font-size: 14px;
    color: #555;
  }
</style>
</head>
<body>

<h1>Фильмы по жанрам</h1>

<div id="genre-menu">Загрузка жанров...</div>

<div id="movies-container">Выберите жанр выше, чтобы увидеть фильмы.</div>

<script>
  const API_KEY = '7cb67565ace3a08cd9d099c749787121';
  const API_BASE = 'https://api.themoviedb.org/3';
  const IMAGE_BASE = 'https://image.tmdb.org/t/p/w300';

  const genreMenu = document.getElementById('genre-menu');
  const moviesContainer = document.getElementById('movies-container');

  let genres = [];

  // Загрузка жанров
  async function loadGenres() {
    try {
      const res = await fetch(`${API_BASE}/genre/movie/list?api_key=${API_KEY}&language=ru`);
      const data = await res.json();
      genres = data.genres;
      renderGenres();
    } catch (e) {
      genreMenu.textContent = 'Ошибка загрузки жанров.';
      console.error(e);
    }
  }

  // Рендер меню жанров
  function renderGenres() {
    genreMenu.innerHTML = '';
    // Добавим кнопку "Все"
    const allBtn = document.createElement('span');
    allBtn.textContent = 'Все';
    allBtn.className = 'genre-link active';
    allBtn.dataset.genreId = 'all';
    genreMenu.appendChild(allBtn);

    allBtn.addEventListener('click', () => {
      setActiveGenre('all');
      loadMovies();
    });

    genres.forEach(genre => {
      const span = document.createElement('span');
      span.textContent = genre.name;
      span.className = 'genre-link';
      span.dataset.genreId = genre.id;
      genreMenu.appendChild(span);

      span.addEventListener('click', () => {
        setActiveGenre(genre.id);
        loadMovies(genre.id);
      });
    });
  }

  // Установить активный жанр в меню
  function setActiveGenre(genreId) {
    const links = document.querySelectorAll('.genre-link');
    links.forEach(link => {
      if (link.dataset.genreId == genreId) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  }

  // Загрузка фильмов по жанру (или всех если genreId не указан)
  async function loadMovies(genreId = 'all') {
    moviesContainer.innerHTML = 'Загрузка фильмов...';

    let url;
    if (genreId === 'all') {
      // Популярные фильмы
      url = `${API_BASE}/movie/popular?api_key=${API_KEY}&language=ru&page=1`;
    } else {
      // Фильмы по жанру
      url = `${API_BASE}/discover/movie?api_key=${API_KEY}&language=ru&with_genres=${genreId}&sort_by=popularity.desc&page=1`;
    }

    try {
      const res = await fetch(url);
      const data = await res.json();
      renderMovies(data.results);
    } catch (e) {
      moviesContainer.innerHTML = 'Ошибка загрузки фильмов.';
      console.error(e);
    }
  }

  // Рендер списка фильмов
  function renderMovies(movies) {
    if (!movies || movies.length === 0) {
      moviesContainer.innerHTML = '<p>Фильмы не найдены.</p>';
      return;
    }

    moviesContainer.innerHTML = '';
    movies.forEach(movie => {
      const div = document.createElement('div');
      div.className = 'movie';

      const posterPath = movie.poster_path ? IMAGE_BASE + movie.poster_path : 'https://via.placeholder.com/300x450?text=No+Image';

      div.innerHTML = `
        <img src="${posterPath}" alt="${movie.title}" />
        <h4>${movie.title}</h4>
        <p>Рейтинг: ${movie.vote_average} ⭐</p>
        <p>${movie.overview.length > 100 ? movie.overview.slice(0, 100) + '...' : movie.overview}</p>
      `;

      moviesContainer.appendChild(div);
    });
  }

  // Инициализация
  loadGenres().then(() => loadMovies());

</script>

</body>
</html>
